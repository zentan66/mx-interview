## 从URL输入到网页显示

1. DNS解析IP地址

DNS优化与应用：

- DNS缓存：在DNS查询中存在多级缓存，从浏览器缓存、系统缓存、路由器缓存、IPS服务器缓存、根域名服务器缓存、顶级域名服务器缓存和主域名服务器缓存
- DNS负载均衡：同一个域名分配多个IP（优点：配置简单，将负载均衡工作交给DNS服务器；缺点：记录的添加和修改需要时间，不能按需分配负载，只能轮训，可能造成额外网络问题）[DNS负载均衡](https://cloud.tencent.com/developer/article/1885429)
- DNS预解析：浏览网页时，会在加载网页时对网页中的域名进行解析缓存

2. TCP连接：三次握手

- 客户端发送一个带 SYN=1，Seq=X 的数据包到服务器端口`（第一次握手，由浏览器发起，告诉服务器我要发送请求了）`；客户端发起请求后，状态变成`ESTABLISHED`，服务端状态是`listen()`

- 服务器发回一个带 SYN=1， ACK=X+1， Seq=Y 的响应包以示传达确认信息`（第二次握手，由服务器发起，告诉浏览器我准备接受了，你赶紧发送吧）`；服务端收到请求后，返回数据包，状态变成`SYN-RCVD`

- 客户端再回传一个带 ACK=Y+1， Seq=Z 的数据包，代表“握手结束”`（第三次握手，由浏览器发送，告诉服务器，我马上就发了，准备接受吧）`；服务端状态转变成`ESTABLISHED`

3. 发送HTTP请求

http的特点：

- 无连接：每次连接至处理一个请求，处理完一次请求后就会断开
- 可拓展的：通过HTTP headers可以快速的拓展语义
- 无状态：对于事务处理没有记忆能力，缺少状态意味着如果后续处理需要之前的信息，那么就必须重传

4. 服务器处理请求并返回HTTP报文

5. 浏览器渲染页面

6. 断开连接：四次挥手

- 发起方向被动方发送报文，Fin、Ack、Seq，表示已经没有数据传输了。并进入 FIN_WAIT_1 状态。 `(第一次挥手：由浏览器发起的，发送给服务器，我请求报文发送完了，你准备关闭吧)`

- 被动方发送报文，Ack、Seq，表示同意关闭请求。此时主机发起方进入 FIN_WAIT_2 状态。 `(第二次挥手：由服务器发起的，告诉浏览器，我请求报文接受完了，我准备关闭了，你也准备吧)`

- 被动方向发起方发送报文段，Fin、Ack、Seq，请求关闭连接。并进入 LAST_ACK 状态。 `(第三次挥手：由服务器发起，告诉浏览器，我响应报文发送完了，你准备关闭吧)`

- 发起方向被动方发送报文段，Ack、Seq。然后进入等待 TIME_WAIT 状态。被动方收到发起方的报文段以后关闭连接。发起方等待一定时间未收到回复，则正常关闭。 `(第四次挥手：由浏览器发起，告诉服务器，我响应报文接受完了，我准备关闭了，你也准备吧)`