## TCP/IP网络模型

TCP/IP 是互联网相关的各类[协议族](https://zhida.zhihu.com/search?content_id=101467016&content_type=Article&match_order=1&q=协议族&zhida_source=entity)的总称，比如：TCP，UDP，IP，FTP，HTTP，ICMP，SMTP 等都属于 TCP/IP 族内的协议。

TCP/IP模型是互联网的基础，它是一系列网络协议的总称。

- 链路层：负责封装和解封装IP报文，发送和接受ARP/RARP报文等 
- 网络层：负责路由以及把分组报文发送给目标网络或主机。
- 传输层：负责对报文进行分组和重组，并以TCP或UDP协议格式封装报文。
- 应用层：负责向用户提供应用程序，比如HTTP、FTP、Telnet、DNS、SMTP等。

### UDP

> 一种无连接的协议，不提供数据包分组，组装以及不能对数据包进行排序

特点如下：

- 面向无连接
- 有单播、多播、广播的功能
- 面向报文
- 不可靠
- 头部开销小，传输数据报文时是很高效的

### TCP

> 一种面向连接的、可靠的、基于字节流的传输层通信协议

#### 三次握手

[一文搞定TCP和UDP的区别](https://zhuanlan.zhihu.com/p/60017840)

#### 为什么可靠传输？

1. 重传机制
   - 超时重传
   - 快速重传
   - SACK
   - D-SACK
2. 滑动窗口
   - 发送窗口
   - 接收窗口
3. 流量控制
   - 窗口关闭
   - 糊涂窗口综合症
   - 操作系统缓冲区
4. 拥塞控制
   - 慢启动
   - 拥塞避免
   - 拥塞发生
   - 快速恢复

### TCP重传

原因：

1. 数据包丢失
2. 数据包损坏
3. 接收方未收到数据包



过程

1. 发送数据：发送方将数据包发送给接收方。
2. 等待确认：发送方等待一定时间，期待接收到接收方发送的确认（ACK）。
3. 超时重传：如果在等待时间内未收到确认，则发送方认为数据包丢失或损坏，将重新发送数据包。
4. 更新超时时间：发送方根据网络情况调整超时时间，以适应网络变化。



重传的优化

1. 超时时间的选择：TCP协议中采用了动态调整的超时时间，根据网络延迟和丢包情况来自适应地选择超时时间，从而减少不必要的重传。
2. 快速重传：TCP协议中引入了快速重传机制，当发送方收到连续的重复确认时，会立即重传未收到确认的数据包，而不必等待超时。
3. 滑动窗口：TCP协议中的滑动窗口机制可以使发送方连续发送多个数据包而不需要等待确认，从而提高网络利用率和传输效率。

## HTTP

### http0.9

**特性：**

1. 支持get，post请求

### http1.0

1. 新增多种请求方式

假如有100张图片，就会建立100个TCP连接

### http1.1

1. 管道化（允许客户端在已发送的请求收到服务端的响应之前发送下一个请求，借此来减少等待时间提高吞吐）
2. 长连接

假如有100张图片，就会建立6个（不一定）TCP长连接

### http2.0

**特性：**

1. 多路复用
2. 服务端推送
3. 二进制分帧（每个消息被拆分成若干个帧进行传输，每个帧分配一个序号，每个帧在传输是属于一个数据流，而一个连接可以存在多个流，每个帧在流和连接上独立传输，到达之后再组成消息 => **解决了http1.1中管道化导致的队头阻塞**）
4. 头部压缩（HPACK算法）



**http长连接其实就是tcp长连接**



## HTTPS

网络层级

| 应用层                                                       | HTTP       |
| ------------------------------------------------------------ | ---------- |
| 安全层                                                       | TLS or SSL |
| 传输层                                                       | TCP        |
| 网络层                                                       | IP         |
| 数据链路层                                                   | 网络接口   |
| **HTTPS 在内容传输的加密上使用的是对称加密，非对称加密只作用在证书验证阶段** |            |

### 请求流程

1. 证书验证阶段
   - 浏览器发起HTTPS请求
   - 服务端返回HTTPS证书
   - 客户端验证证书是否合法，如果不合法则提示告警
2. 数据传输阶段
   - 当证书验证合法后，在本地生成随机数
   - 通过公钥加密随机数，并把加密后的随机数传输到服务端
   - 服务端通过私钥对随机数进行解密
   - 服务端通过客户端传入的随机数构造加密算法，对返回的结果内容进行加密后传输

为什么数据传输是用对称加密？

- 非对称加密的加解密效率非常低

为什么需要CA机构颁发证书？

防止“中间人”攻击

使用https会被抓包吗？

会被抓包，HTTPS只防止用户在不知情的情况下通信被监听，如果用户主动授信，是可以构建“中间人”网络，代理软件可以对传输内容进行解密

## 队头阻塞

### HTTP队头阻塞

队列上传输的数据有严格的顺序约束，比如TCP要求数据严格按照序号顺序，HTTP管道化要求响应严格按照请求顺序返回

### TCP队头阻塞

队头阻塞发生在一个TCP分节丢失，导致后续分节不按序到达接收端。该后续分节将被接收端一直保持直到丢失的第一个分节被发送端重传并到达接收端为止。

独立的消息数据都在一个链路上传输，也就是一个队列，比如TCP只有一个流，多个HTTP请求共用一个TCP连接

